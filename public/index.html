<!DOCTYPE html>
<html>
  <head>
    <link type="text/css" rel="stylesheet" href="style.css"/>

    <script src="/socket.io/socket.io.js"></script>
    <script>
      navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia ||
          navigator.mozGetUserMedia || navigator.msGetUserMedia;
      window.URL = window.URL || window.webkitURL;
      var userId;
      var socket = io.connect('http://localhost');
      socket.on('new_player', function (data) {
        console.log(data);
        // Set a global ID
        userId = data.id;
        // TODO: insert tiles
      });

      socket.on('need_img', function(data){
        if(userId === data.id){
          var imgData = getSnapShot();
          socket.emit('upload_img', { img: imgData });
        }
      });

      initVideo();

      function getSnapShot() {
        var canvas = document.getElementById('canvas');
        var context = canvas.getContext('2d');
        //grab snapshot
        context.drawImage(video, 0, 0);
        //capture base 64 data
        return canvas.toDataURL();
      }

      function initVideo() {
        var video;
        navigator.getUserMedia({
          video: true
        }, function(localMediaStream) {
          video = document.getElementById("myVideo");
          video.src = window.URL.createObjectURL(localMediaStream);
        }, function(error) {
          console.log(error);
        });
      }

    </script>
  </head>
  <body>
    <video id="myVideo" autoplay></video>
    <canvas id="canvas" height="480" width="640"></canvas>
  </body>
</html>